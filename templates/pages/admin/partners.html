{% if current_user.privileges != 'Admin' %}
{% extends 'layouts/base.html' %}
{% else %}
{% extends 'layouts/adminbase.html' %}
{% endif %}
{% block title %}HOOP | Partners{% endblock %}

{% block header %}
<h2>Partners
    {% if (current_user.privileges != 'Admin') %}
    <a href="{{ url_for('index') }}" title="Back to homepage"><i class="fa fa-home pull-right"></i></a>
    {% else %}
    <a href="{{ url_for('admin_index') }}" title="Back to homepage"><i class="fa fa-home pull-right"></i></a>
    {% endif %}
</h2>
{% endblock %}

{% block content %}
<div id="table"></div>
{% endblock %}

{% block scripts %}
<script>
    const updateUrl = (prev, query) => {
        return prev + (prev.indexOf('?') >= 0 ? '&' : '?') + new URLSearchParams(query).toString();
    };

    new gridjs.Grid({
        columns: [
            { id: 's_n', name: 'S/N', width:'50px' },
            { id: 'partner_id', name: 'Partner ID', formatter: (cell) => gridjs.html(`<a href='/partners/${cell}/edit'}}'>${cell}</a>`), width:'150px' },
            { id: 'partner_name', name: 'Partner Name', width:'100px' },
            { id: 'partner_contact', name: 'Partner Contact', width:'100px' },
            { id: 'partner_address', name: 'Partner Address', width:'100px' },
            { id: 'del', name: '', width:'00px', formatter: (_, row) => gridjs.html(`<a href='/partners/${row.cells[1].data}/delete'}}' onclick="return confirm('Are you sure you want to delete this partner?');"><i class="fa-solid fa-trash"></i></a>`) }
        ],
        resizable: true,
        height: '50%',
        server: {
            url: '/partners/data',
            then: results => results.data,
            total: results => results.total,
        },
        search: {
            enabled: true,
            server: {
                url: (prev, search) => {
                    return updateUrl(prev, { search });
                },
            },
        },
        pagination: {
            enabled: true,
            server: {
                url: (prev, page, limit) => {
                    return updateUrl(prev, { start: page * limit, length: limit });
                },
            },
        },
        language: {
            'search': {
                'placeholder': '🔍 Search...'
            },
            'pagination': {
                'previous': 'Previous',
                'next': 'Next',
                'showing': 'Displaying',
                'results': () => 'Records'
            }
        },
        className: {
            table: 'table-responsive'
        }
    }).render(document.getElementById('table'));
</script>
{% endblock %}